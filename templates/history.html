<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pneumonia Diagnosis History</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding-top: 70px;
      min-height: 100vh;
      background: linear-gradient(160deg, #ffecd2, #fcb69f);
    }
    .container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 25px;
      max-width: 1200px;
      margin: auto;
      box-shadow: 0 12px 35px rgba(0,0,0,0.25);
    }
    table img { width: 80px; border-radius: 12px; }
    h2 { font-weight: bold; color: #ff4b2b; }
    .navbar { position: fixed; top: 0; width: 100%; z-index: 1000; background: linear-gradient(to right, #ff4b2b, #ff416c); }
    .btn-primary { background: linear-gradient(to right, #ff7e5f, #feb47b); border: none; }
    .btn-danger { background: linear-gradient(to right, #ff416c, #ff4b2b); border: none; }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="{{ url_for('index') }}">PneumoniaCare ðŸ©º</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}">Home</a></li>
        <li class="nav-item"><a class="nav-link active" href="{{ url_for('view_history') }}">History</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mx-auto">Diagnosis History</h2>
    <form method="POST" action="{{ url_for('clear_history') }}">
      <button type="submit" class="btn btn-danger btn-sm">Clear History</button>
    </form>
  </div>

  <table class="table table-bordered table-hover shadow-sm rounded text-center">
    <thead class="table-primary">
      <tr>
        <th>Image</th>
        <th>Disease</th>
        <th>Confidence</th>
        <th>Stage</th>
        <th>Timestamp</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% if history %}
        {% for record in history %}
        <tr class="align-middle">
          <td><img src="{{ url_for('static', filename='uploads/' + record.filename) }}" alt="X-ray"></td>
          <td>{{ record.prediction }}</td>
          <td>{{ record.confidence }}%</td>
          <td>{{ record.stage }}</td>
          <td>{{ record.timestamp }}</td>
          <td>
            <a href="{{ url_for('download_pdf', record_index=loop.index0) }}" class="btn btn-primary btn-sm">
              ðŸ“„ Download PDF
            </a>
          </td>
        </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="6" class="text-center text-muted">No history available.</td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>

</body>
</html>